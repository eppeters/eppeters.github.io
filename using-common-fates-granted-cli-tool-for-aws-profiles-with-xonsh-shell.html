<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
      <title>dinogalactic &mdash; Using Common Fate's Granted CLI tool for AWS profiles with Xonsh shell</title>
    <!-- Primary Meta Tags -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./theme/css/typesetter.css" />
    <link rel="stylesheet" href="./theme/css/typesetter-extensions.css" />
    <link href="https://www.dinogalactic.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="dinogalactic Full Atom Feed" />
    <link href="https://www.dinogalactic.com/feeds/xonshiousness.atom.xml" type="application/atom+xml" rel="alternate" title="dinogalactic Categories Atom Feed" />
  </head>
  <body>
    <header><a href="./" alt="dinogalactic">dinogalactic</a></header>
    <nav>
        <h1>Navigation</h1>
        <ul>
              <li><a href="./pages/about.html">about</a></li>
              <li><a href="./pages/booksread.html">books</a></li>

              <li><a href="./category/aws.html">AWS</a></li>
              <li><a href="./category/misc.html">misc</a></li>
              <li><a href="./category/xonshiousness.html">xonshiousness</a></li>
        </ul>
    </nav>
    <main>
<h1>Using Common Fate's Granted CLI tool for AWS profiles with Xonsh shell</h1>
<p>Using <a href="https://github.com/common-fate/granted">Common Fate's excellent Granted CLI tool for AWS profiles</a> with <a href="https://xon.sh/">Xonsh shell</a>:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><code><span style="color: #0099FF; font-style: italic">#!/usr/bin/env xonsh</span>

<span style="color: #006699; font-weight: bold">def</span> <span style="color: #CC00FF">_assume</span>(args):
    AWS_VARIABLE_NAMES <span style="color: #555555">=</span> [
        <span style="color: #CC3300">&quot;AWS_ACCESS_KEY_ID&quot;</span>,
        <span style="color: #CC3300">&quot;AWS_SECRET_ACCESS_KEY&quot;</span>,
        <span style="color: #CC3300">&quot;AWS_SESSION_TOKEN&quot;</span>,
        <span style="color: #CC3300">&quot;AWS_PROFILE&quot;</span>,
        <span style="color: #CC3300">&quot;AWS_REGION&quot;</span>,
        <span style="color: #CC3300">&quot;AWS_SESSION_EXPIRATION&quot;</span>
    ]

    <span style="color: #003333">$GRANTED_ALIAS_CONFIGURED</span> <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;true&quot;</span>

    <span style="color: #003333">$GRANTED_OUTPUT</span> <span style="color: #555555">=</span> <span style="color: #006699; font-weight: bold">$</span>(<span style="color: #AA0000; background-color: #FFAAAA">assumego</span> <span style="color: #006699; font-weight: bold">@</span>(args))

    granted_flag, <span style="color: #555555">*</span>aws_variable_values <span style="color: #555555">=</span> <span style="color: #003333">$GRANTED_OUTPUT</span><span style="color: #555555">.</span>strip(<span style="color: #CC3300">&#39;</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&#39;</span>)<span style="color: #555555">.</span>split(<span style="color: #CC3300">&#39; &#39;</span>)

    <span style="color: #006699; font-weight: bold">if</span> granted_flag <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;GrantedOutput&quot;</span>:
        <span style="color: #0099FF; font-style: italic"># Remove the first line of output</span>
        granted_output <span style="color: #555555">=</span> <span style="color: #CC3300">&#39;</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&#39;</span><span style="color: #555555">.</span>join(<span style="color: #003333">$GRANTED_OUTPUT</span><span style="color: #555555">.</span>split(<span style="color: #CC3300">&#39;</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&#39;</span>)[<span style="color: #FF6600">1</span>:])
        <span style="color: #336666">print</span>(granted_output)
        exit()

    <span style="color: #006699; font-weight: bold">for</span> aws_variable_name, aws_variable_value <span style="color: #000000; font-weight: bold">in</span> <span style="color: #336666">zip</span>(AWS_VARIABLE_NAMES, aws_variable_values):
        <span style="color: #006699; font-weight: bold">if</span> granted_flag <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;GrantedDesume&quot;</span> <span style="color: #000000; font-weight: bold">or</span> aws_variable_value <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;None&quot;</span>:
            <span style="color: #006699; font-weight: bold">$</span>{<span style="color: #555555">...</span>}<span style="color: #555555">.</span>pop(aws_variable_name, <span style="color: #006699; font-weight: bold">None</span>)
            <span style="color: #006699; font-weight: bold">continue</span>
        <span style="color: #006699; font-weight: bold">if</span> granted_flag <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;GrantedAssume&quot;</span>:
            <span style="color: #006699; font-weight: bold">$</span>{<span style="color: #555555">...</span>}[aws_variable_name] <span style="color: #555555">=</span> aws_variable_value

    <span style="color: #006699; font-weight: bold">if</span> granted_flag <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;GrantedOutput&quot;</span>:
        <span style="color: #006699; font-weight: bold">for</span> aws_variable_name, aws_variable_value <span style="color: #000000; font-weight: bold">in</span> <span style="color: #336666">zip</span>(AWS_VARIABLE_NAMES, aws_variable_values):
            <span style="color: #006699; font-weight: bold">if</span> aws_variable_value <span style="color: #555555">==</span> <span style="color: #CC3300">&quot;None&quot;</span>:
                <span style="color: #006699; font-weight: bold">$</span>{<span style="color: #555555">...</span>}<span style="color: #555555">.</span>pop(aws_variable_name, <span style="color: #006699; font-weight: bold">None</span>)
                <span style="color: #006699; font-weight: bold">continue</span>
            <span style="color: #006699; font-weight: bold">$</span>{<span style="color: #555555">...</span>}[aws_variable_name] <span style="color: #555555">=</span> aws_variable_value

    <span style="color: #006699; font-weight: bold">del</span> <span style="color: #003333">$GRANTED_ALIAS_CONFIGURED</span>

aliases[<span style="color: #CC3300">&#39;assume&#39;</span>] <span style="color: #555555">=</span> _assume
</code></pre></div>


<p>Place in your <code>xontrib</code> directory. And, in <code>.xonshrc</code>:</p>
<div class="codehilite" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><code>xontrib load assume
</code></pre></div>
    </main>
    <aside>
        <h1>Tags</h1>
        <ul>
            <li><a href="./tag/amateur-radio.html">amateur radio</a></li>
            <li><a href="./tag/aws.html">aws</a></li>
            <li><a href="./tag/career.html">career</a></li>
            <li><a href="./tag/cdk.html">cdk</a></li>
            <li><a href="./tag/docker.html">docker</a></li>
            <li><a href="./tag/evergreen.html">evergreen</a></li>
            <li><a href="./tag/gardening.html">gardening</a></li>
            <li><a href="./tag/ham-radio.html">ham radio</a></li>
            <li><a href="./tag/jsii.html">jsii</a></li>
            <li><a href="./tag/kids.html">kids</a></li>
            <li><a href="./tag/learning.html">learning</a></li>
            <li><a href="./tag/linux.html">linux</a></li>
            <li><a href="./tag/open-source.html">open source</a></li>
            <li><a href="./tag/parenting.html">parenting</a></li>
            <li><a href="./tag/project-management.html">project management</a></li>
            <li><a href="./tag/projects.html">projects</a></li>
            <li><a href="./tag/projen.html">projen</a></li>
            <li><a href="./tag/python.html">python</a></li>
            <li><a href="./tag/raspi.html">raspi</a></li>
            <li><a href="./tag/resume.html">resume</a></li>
            <li><a href="./tag/shell.html">shell</a></li>
            <li><a href="./tag/software-development.html">software development</a></li>
            <li><a href="./tag/ubitx.html">ubitx</a></li>
            <li><a href="./tag/xonsh.html">xonsh</a></li>
            <li><a href="./tag/xontribs.html">xontribs</a></li>
        </ul>
    </aside>
<script data-goatcounter="https://dinogalactic.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>  </body>
</html>